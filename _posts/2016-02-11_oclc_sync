---
layout: post
title: Syncronizing OCLC holdings
tags: OCLC Evergreen
categories: systems
---
In early 2016, we syncronized our OCLC holdings with our actual holdings found in Evergreen.

{% highlight sql %}
SELECT xpath('//m:datafield[@tag="035"]/m:subfield[@code="a"]/text()',
  b.marc::xml, ARRAY[ARRAY['m','http://www.loc.gov/MARC21/slim']])::VARCHAR as oclc
  FROM biblio.record_entry b
  INNER JOIN asset.call_number cn ON cn.record=b.id
  INNER JOIN asset.copy c ON c.call_number=cn.id
  INNER JOIN actor.org_unit ou on ou.id=c.circ_lib
  WHERE b.deleted=FALSE
  AND b.marc LIKE '%tag="035%'
  AND (b.marc LIKE '%OCoLC%'
  OR b.marc LIKE '%ocn%'
  OR b.marc LIKE '%ocm%')
  AND (c.location =224 -- LBCC STACKS
  OR c.location = 434 -- LBCC's Music
  OR c.location =244) -- LBCC's chapter books
  AND c.circ_modifier = 'DEFAULT'
  AND cn.label NOT LIKE 'ILL%'
  AND c.circ_lib=7
  AND b.id != -1
  AND c.barcode NOT ILIKE '%SITE%';
{% endhighlight %}
